!function(e,i,l){"use strict";var n=function(){return"lfobjxxxxxxxx".replace(/[xy]/g,function(e){var i=16*Math.random()|0,l="x"==e?i:3&i|8;return l.toString(16)})},t=i.module("lfNgMdFileInput",["ngMaterial"]);t.directive("srcfix",function(){return{restrict:"A",link:function(e,i,l){l.$set("src",l.vsrc)}}}),t.run(function(e){e.put("lfNgMdFileinput.html",['<div layout="column" class="lf-ng-md-file-input" ng-model="'+n()+'">','<div layout="column" class="lf-ng-md-file-input-preview-container" ng-class="{\'disabled\':isDisabled}" ng-show="isDrag || (isPreview && !isFilesNull)">','<md-button aria-label="remove all files" class="close lf-ng-md-file-input-x" ng-click="removeAllFiles($event)" ng-hide="isFilesNull || !isPreview" >&times;</md-button>','<div class="lf-ng-md-file-input-drag">','<div layout="row" layout-align="center center" class="lf-ng-md-file-input-drag-text-container" ng-show="(isFilesNull || !isPreview) && isDrag">','<div class="lf-ng-md-file-input-drag-text">{{strCaptionDragAndDrop}}</div>',"</div>",'<div class="lf-ng-md-file-input-thumbnails" ng-show="isPreview">','<div class="lf-ng-md-file-input-frame" ng-repeat="lffile in lfFiles" ng-switch on="lffile.lfTagType" ng-click="onFileClick(lffile.lfFileName)">','<div class="lf-ng-md-file-input-x" aria-label="remove {{lffile.lfFileName}}" ng-click="removeFileByName(lffile.lfFileName,$event)">&times;</div>','<img ng-switch-when="image" ng-src="{{lffile.lfDataUrl}}" >','<video ng-switch-when="video" controls>','<source vsrc="{{lffile.lfDataUrl}}" ng-attr-type="{{lffile.lfFile.type}}" srcfix>',"</video>",'<audio ng-switch-when="audio" controls>','<source vsrc="{{lffile.lfDataUrl}}" ng-attr-type="{{lffile.lfFile.type}}" srcfix>',"</audio>",'<object ng-switch-when="object" ng-attr-data="{{lffile.lfDataUrl}}" ng-attr-type="{{lffile.lfFile.type}}">','<div class="lf-ng-md-file-input-preview-default">','<md-icon class="lf-ng-md-file-input-preview-icon" ng-class="strUnknowIconCls"></md-icon>',"</div>","</object>",'<md-progress-linear md-mode="indeterminate"></md-progress-linear>','<div class="lf-ng-md-file-input-frame-footer">','<div class="lf-ng-md-file-input-frame-caption">{{lffile.lfFileName}}</div>',"</div>","</div>","</div>",'<div class="clearfix" style="clear:both"></div>',"</div>","</div>",'<div layout="row" class="lf-ng-md-file-input-container" >','<div class="lf-ng-md-file-input-caption" layout="row" layout-align="start center" flex ng-class="{\'disabled\':isDisabled}" >','<md-icon class="lf-icon" ng-class="strCaptionIconCls"></md-icon>','<div flex class="lf-ng-md-file-input-caption-text-default" ng-show="isFilesNull">',"{{strCaptionPlaceholder}}","</div>",'<div flex class="lf-ng-md-file-input-caption-text" ng-hide="isFilesNull">',"{{strCaption}}","</div>",'<md-progress-linear md-mode="determinate" value="{{floatProgress}}" ng-show="intLoading && isProgress"></md-progress-linear>',"</div>",'<md-button aria-label="remove all files" ng-disabled="isDisabled" ng-click="removeAllFiles()" ng-hide="isFilesNull || intLoading" class="md-raised lf-ng-md-file-input-button lf-ng-md-file-input-button-remove" >','<md-icon class="lf-icon" ng-class="strRemoveIconCls"></md-icon> ',"{{strCaptionRemove}}","</md-button>",'<md-button ng-disabled="isDisabled" ng-click="openDialog($event, this)" class="md-raised md-primary lf-ng-md-file-input-button lf-ng-md-file-input-button-brower" >','<md-icon class="lf-icon" ng-class="strBrowseIconCls"></md-icon> ',"{{strCaptionBrowse}}",'<input type="file" aria-label="{{strAriaLabel}}" accept="{{accept}}" ng-disabled="isDisabled" class="lf-ng-md-file-input-tag" />',"</md-button>","</div>","</div>"].join(""))}),t.filter("lfTrusted",["$sce",function(e){return function(i){return e.trustAsResourceUrl(i)}}]),t.directive("lfRequired",function(){return{restrict:"A",require:"ngModel",link:function(e,i,l,n){n&&(n.$validators.required=function(e,i){return e?e.length>0:!1})}}}),t.directive("lfMaxcount",function(){return{restrict:"A",require:"ngModel",link:function(e,i,l,n){if(n){var t=-1;l.$observe("lfMaxcount",function(e){var i=parseInt(e,10);t=isNaN(i)?-1:i,n.$validate()}),n.$validators.maxcount=function(e,i){return e?e.length<=t:!1}}}}}),t.directive("lfFilesize",function(){return{restrict:"A",require:"ngModel",link:function(e,i,l,n){if(n){var t=-1;l.$observe("lfFilesize",function(e){var i=/^[1-9][0-9]*(Byte|KB|MB)$/;if(i.test(e)){var l=["Byte","KB","MB"],r=e.match(i)[1],o=e.substring(0,e.indexOf(r));l.every(function(e,i){return r===e?(t=parseInt(o)*Math.pow(1024,i),!1):!0})}else t=-1;n.$validate()}),n.$validators.filesize=function(e,i){if(!e)return!1;var l=!0;return e.every(function(e,i){return e.lfFile.size>t?(l=!1,!1):!0}),l}}}}}),t.directive("lfTotalsize",function(){return{restrict:"A",require:"ngModel",link:function(e,l,n,t){if(t){var r=-1;n.$observe("lfTotalsize",function(e){var i=/^[1-9][0-9]*(Byte|KB|MB)$/;if(i.test(e)){var l=["Byte","KB","MB"],n=e.match(i)[1],o=e.substring(0,e.indexOf(n));l.every(function(e,i){return n===e?(r=parseInt(o)*Math.pow(1024,i),!1):!0})}else r=-1;t.$validate()}),t.$validators.totalsize=function(e,l){if(!e)return!1;var n=0;return i.forEach(e,function(e,i){n+=e.lfFile.size}),r>n}}}}}),t.directive("lfMimetype",function(){return{restrict:"A",require:"ngModel",link:function(e,i,l,n){if(n){var t;l.$observe("lfMimetype",function(e){t=new RegExp(e,"i"),n.$validate()}),n.$validators.mimetype=function(e,i){if(!e)return!1;var l=!0;return e.every(function(e,i){return e.lfFile.type.match(t)?!0:(l=!1,!1)}),l}}}}}),t.directive("lfNgMdFileInput",["$q","$compile","$timeout",function(t,r,o){return{restrict:"E",templateUrl:"lfNgMdFileinput.html",replace:!0,require:"ngModel",scope:{lfFiles:"=?",lfApi:"=?",lfOption:"=?",lfCaption:"@?",lfPlaceholder:"@?",lfDragAndDropLabel:"@?",lfBrowseLabel:"@?",lfRemoveLabel:"@?",lfOnFileClick:"=?",accept:"@?",ngDisabled:"=?"},link:function(r,a,s,f){var c=i.element(a[0].querySelector(".lf-ng-md-file-input-tag")),d=i.element(a[0].querySelector(".lf-ng-md-file-input-drag")),u=i.element(a[0].querySelector(".lf-ng-md-file-input-thumbnails")),g=!1,p=0;r.intLoading=0,r.floatProgress=0,r.isPreview=!1,r.isDrag=!1,r.isMutiple=!1,r.isProgress=!1,i.isDefined(s.preview)&&(r.isPreview=!0),i.isDefined(s.drag)&&(r.isDrag=!0),i.isDefined(s.multiple)?(c.attr("multiple","multiple"),r.isMutiple=!0):c.removeAttr("multiple"),i.isDefined(s.progress)&&(r.isProgress=!0),r.isDisabled=!1,i.isDefined(s.ngDisabled)&&r.$watch("ngDisabled",function(e){r.isDisabled=e}),r.strBrowseIconCls="lf-browse",r.strRemoveIconCls="lf-remove",r.strCaptionIconCls="lf-caption",r.strUnknowIconCls="lf-unknow",i.isDefined(s.lfOption)&&i.isObject(r.lfOption)&&(r.lfOption.hasOwnProperty("browseIconCls")&&(r.strBrowseIconCls=r.lfOption.browseIconCls),r.lfOption.hasOwnProperty("removeIconCls")&&(r.strRemoveIconCls=r.lfOption.removeIconCls),r.lfOption.hasOwnProperty("captionIconCls")&&(r.strCaptionIconCls=r.lfOption.captionIconCls),r.lfOption.hasOwnProperty("unknowIconCls")&&(r.strUnknowIconCls=r.lfOption.unknowIconCls)),r.accept=r.accept||"",r.lfFiles=[],r[s.ngModel]=r.lfFiles,r.$watch("lfFiles.length",function(e,i){f.$validate()}),r.lfApi=new function(){var e=this;e.removeAll=function(){r.removeAllFiles()},e.removeByName=function(e){r.removeFileByName(e)}},r.isFilesNull=!0,r.strCaption="",r.strCaptionPlaceholder="Select file",r.strCaptionDragAndDrop="Drag & drop files here...",r.strCaptionBrowse="Browse",r.strCaptionRemove="Remove",r.strAriaLabel="",i.isDefined(s.ariaLabel)&&(r.strAriaLabel=s.ariaLabel),i.isDefined(s.lfPlaceholder)&&r.$watch("lfPlaceholder",function(e){r.strCaptionPlaceholder=e}),i.isDefined(s.lfCaption)&&(g=!0,r.$watch("lfCaption",function(e){r.strCaption=e})),r.lfDragAndDropLabel&&(r.strCaptionDragAndDrop=r.lfDragAndDropLabel),r.lfBrowseLabel&&(r.strCaptionBrowse=r.lfBrowseLabel),r.lfRemoveLabel&&(r.strCaptionRemove=r.lfRemoveLabel),d.bind("dragover",function(e){e.stopPropagation(),e.preventDefault(),!r.isDisabled&&r.isDrag&&d.addClass("lf-ng-md-file-input-drag-hover")}),d.bind("dragleave",function(e){e.stopPropagation(),e.preventDefault(),!r.isDisabled&&r.isDrag&&d.removeClass("lf-ng-md-file-input-drag-hover")}),d.bind("drop",function(e){if(e.stopPropagation(),e.preventDefault(),!r.isDisabled&&r.isDrag){d.removeClass("lf-ng-md-file-input-drag-hover"),i.isObject(e.originalEvent)&&(e=e.originalEvent);var l=e.target.files||e.dataTransfer.files,n=0;if(!(l.length<=0)){var t=r.lfFiles.map(function(e){return e.lfFileName}),o=new RegExp(r.accept,"i");if(r.floatProgress=0,r.isMutiple){p=l.length;for(var n=0;n<l.length;n++){var a=l[n];a.type.match(o)&&(-1!=t.indexOf(a.name)&&r.removeFileByName(a.name),setTimeout(m(a),100*n))}}else{p=1;for(var n=0;n<l.length;n++){var a=l[n];if(a.type.match(o)){r.removeAllFiles(),setTimeout(m(a),100);break}}}}}}),r.openDialog=function(e,i){e&&o(function(){e.preventDefault(),e.stopPropagation();var i=e.target.children[2];i!==l&&i.click()},0)},r.removeAllFiles=function(e){r.isDisabled||(r.lfFiles.length=0,u.empty(),v())},r.removeFileByName=function(e,i){r.isDisabled||(r.lfFiles.every(function(i,l){return i.lfFileName==e?(r.lfFiles.splice(l,1),!1):!0}),v())},r.onFileChanged=function(e){var i=e.files||e.target.files,l=r.lfFiles.map(function(e){return e.lfFileName});if(!(i.length<=0)){if(r.floatProgress=0,r.isMutiple){p=i.length;for(var n=0;n<i.length;n++){var t=i[n];-1!=l.indexOf(t.name)&&r.removeFileByName(t.name),setTimeout(m(t),100*n)}}else{p=1;for(var n=0;n<i.length;n++){var t=i[n];r.removeAllFiles(),setTimeout(m(t),100);break}}c.val("")}},c.bind("change",r.onFileChanged),r.onFileClick=function(e){i.isFunction(r.lfOnFileClick)&&r.lfFiles.every(function(i,l){return i.lfFileName==e?(r.lfOnFileClick(i,l),!1):!0})};var m=function(i){r.intLoading++,y(i).then(function(l){var t=i,o=i.name,a=(i.type,h(i)),s=e.URL.createObjectURL(i),f={key:n(),lfFile:t,lfFileName:o,lfDataUrl:s,lfTagType:a};r.lfFiles.push(f),v()},function(e){},function(e){})},v=function(){1==r.lfFiles.length?(g||(r.strCaption=""+r.lfFiles[0].lfFileName),r.isFilesNull=!1):r.lfFiles.length>1?(g||(r.strCaption=""+r.lfFiles.length+" files selected"),r.isFilesNull=!1):(g||(r.strCaption=""),r.isFilesNull=!0)},h=function(e){var i=e.type,l=e.name;return b(i,l)?"image":F(i,l)?"video":w(i,l)?"audio":"object"},b=function(e,i){return!(!e.match("image.*")&&!i.match(/\.(gif|png|jpe?g)$/i))},F=function(e,i){return!(!e.match("video.*")&&!i.match(/\.(og?|mp4|webm|3gp)$/i))},w=function(e,i){return!(!e.match("audio.*")&&!i.match(/\.(ogg|mp3|wav)$/i))},y=function(e,i){var l=t.defer(),n=new FileReader;return n.onloadstart=function(){l.notify(0)},n.onload=function(e){},n.onloadend=function(e){l.resolve({index:i,result:n.result}),r.intLoading--,r.floatProgress=(p-r.intLoading)/p*100},n.onerror=function(e){l.reject(n.result),r.intLoading--,r.floatProgress=(p-r.intLoading)/p*100},n.onprogress=function(e){l.notify(e.loaded/e.total)},n.readAsArrayBuffer(e),l.promise}}}}])}(window,window.angular);