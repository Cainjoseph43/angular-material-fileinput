!function(e,i,t){"use strict";var n=function(){return"lfobjxxxxxxxx".replace(/[xy]/g,function(e){var i=16*Math.random()|0,t="x"==e?i:3&i|8;return t.toString(16)})},l=i.module("lfNgMdFileInput",["ngMaterial"]);l.filter("lfTrusted",["$sce",function(e){return function(i){return e.trustAsResourceUrl(i)}}]),l.directive("lfRequired",function(){return{restrict:"A",require:"ngModel",link:function(e,i,t,n){n&&(n.$validators.required=function(e,i){return!!e&&e.length>0})}}}),l.directive("lfMaxcount",function(){return{restrict:"A",require:"ngModel",link:function(e,i,t,n){if(n){var l=-1;t.$observe("lfMaxcount",function(e){var i=parseInt(e,10);l=isNaN(i)?-1:i,n.$validate()}),n.$validators.maxcount=function(e,i){return!!e&&e.length<=l}}}}}),l.directive("lfFilesize",function(){return{restrict:"A",require:"ngModel",link:function(e,i,t,n){if(n){var l=-1;t.$observe("lfFilesize",function(e){var i=/^[1-9][0-9]*(Byte|KB|MB)$/;if(i.test(e)){var t=["Byte","KB","MB"],r=e.match(i)[1],o=e.substring(0,e.indexOf(r));t.every(function(e,i){return r!==e||(l=parseInt(o)*Math.pow(1024,i),!1)})}else l=-1;n.$validate()}),n.$validators.filesize=function(e,i){if(!e)return!1;var t=!0;return e.every(function(e,i){return!(e.lfFile.size>l)||(t=!1,!1)}),t}}}}}),l.directive("lfTotalsize",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,l){if(l){var r=-1;n.$observe("lfTotalsize",function(e){var i=/^[1-9][0-9]*(Byte|KB|MB)$/;if(i.test(e)){var t=["Byte","KB","MB"],n=e.match(i)[1],o=e.substring(0,e.indexOf(n));t.every(function(e,i){return n!==e||(r=parseInt(o)*Math.pow(1024,i),!1)})}else r=-1;l.$validate()}),l.$validators.totalsize=function(e,t){if(!e)return!1;var n=0;return i.forEach(e,function(e,i){n+=e.lfFile.size}),n<r}}}}}),l.directive("lfMimetype",function(){return{restrict:"A",require:"ngModel",link:function(e,i,t,n){if(n){var l;t.$observe("lfMimetype",function(e){l=new RegExp(e,"i"),n.$validate()}),n.$validators.mimetype=function(e,i){if(!e)return!1;var t=!0;return e.every(function(e,i){return!!e.lfFile.type.match(l)||(t=!1,!1)}),t}}}}}),l.directive("lfNgMdFileInput",["$q","$compile","$timeout",function(l,r,o){return{restrict:"E",template:['<div layout="column" class="lf-ng-md-file-input" ng-model="'+n()+'">','<div layout="column" class="lf-ng-md-file-input-preview-container" ng-class="{\'disabled\':isDisabled}" ng-show="isDrag || (isPreview && !isFilesNull)">','<md-button aria-label="remove all files" class="close lf-ng-md-file-input-x" ng-click="removeAllFiles($event)" ng-hide="isFilesNull || !isPreview" >&times;</md-button>','<div class="lf-ng-md-file-input-drag">','<div layout="row" layout-align="center center" class="lf-ng-md-file-input-drag-text-container" ng-show="(isFilesNull || !isPreview) && isDrag">','<div class="lf-ng-md-file-input-drag-text">{{strCaptionDragAndDrop}}</div>',"</div>",'<div class="lf-ng-md-file-input-thumbnails" ng-show="isPreview">',"</div>",'<div class="clearfix" style="clear:both"></div>',"</div>","</div>",'<div layout="row" class="lf-ng-md-file-input-container" >','<div class="lf-ng-md-file-input-caption" layout="row" layout-align="start center" flex ng-class="{\'disabled\':isDisabled}" >','<md-icon class="lf-icon" ng-class="strCaptionIconCls"></md-icon>','<div flex class="lf-ng-md-file-input-caption-text-default" ng-show="isFilesNull">',"{{strCaptionPlaceholder}}","</div>",'<div flex class="lf-ng-md-file-input-caption-text" ng-hide="isFilesNull">',"{{strCaption}}","</div>",'<md-progress-linear md-mode="determinate" value="{{floatProgress}}" ng-show="intLoading && isProgress"></md-progress-linear>',"</div>",'<md-button aria-label="remove all files" ng-disabled="isDisabled" ng-click="removeAllFiles()" ng-hide="isFilesNull || intLoading" class="md-raised lf-ng-md-file-input-button lf-ng-md-file-input-button-remove" >','<md-icon class="lf-icon" ng-class="strRemoveIconCls"></md-icon> ',"{{strCaptionRemove}}","</md-button>",'<md-button ng-disabled="isDisabled" ng-click="openDialog($event, this)" class="md-raised lf-ng-md-file-input-button lf-ng-md-file-input-button-brower" ng-class="strBrowseButtonCls" ng-show="lfFiles.length == 0">','<md-icon class="lf-icon" ng-class="strBrowseIconCls"></md-icon> ',"{{strCaptionBrowse}}",'<input type="file" aria-label="{{strAriaLabel}}" accept="{{accept}}" ng-disabled="isDisabled" class="lf-ng-md-file-input-tag" />',"</md-button>",'<md-button id="submitButton" ng-disabled="isDisabled" class="md-raised lf-ng-md-file-input-button lf-ng-md-file-input-button-brower" ng-class="strSubmitButtonCls" ng-show="lfFiles.length > 0">','<md-icon class="lf-icon" ng-class="strSubmitIconCls"></md-icon> ',"{{strCaptionSubmit}}","</md-button>","</div>","</div>"].join(""),replace:!0,require:"ngModel",scope:{lfFiles:"=?",lfApi:"=?",lfOption:"=?",lfCaption:"@?",lfPlaceholder:"@?",lfDragAndDropLabel:"@?",lfBrowseLabel:"@?",lfRemoveLabel:"@?",lfSubmitLabel:"@?",lfOnFileClick:"=?",lfSubmit:"&",accept:"@?",ngDisabled:"=?"},link:function(s,a,f,u){var c=i.element(a[0].querySelector(".lf-ng-md-file-input-tag")),d=i.element(a[0].querySelector(".lf-ng-md-file-input-drag")),m=i.element(a[0].querySelector(".lf-ng-md-file-input-thumbnails")),p=!1,g=0,v=s.lfSubmit();if(s.intLoading=0,s.floatProgress=0,s.isPreview=!1,s.isDrag=!1,s.isMutiple=!1,s.isProgress=!1,i.isDefined(f.preview)&&(s.isPreview=!0),i.isDefined(f.drag)&&(s.isDrag=!0),i.isDefined(f.multiple)?(c.attr("multiple","multiple"),s.isMutiple=!0):c.removeAttr("multiple"),i.isDefined(f.progress)&&(s.isProgress=!0),s.isDisabled=!1,i.isDefined(f.ngDisabled)&&s.$watch("ngDisabled",function(e){s.isDisabled=e}),s.strBrowseIconCls="lf-browse",s.strRemoveIconCls="lf-remove",s.strCaptionIconCls="lf-caption",s.strSubmitIconCls="lf-submit",s.strUnknowIconCls="lf-unknow",s.strBrowseButtonCls="md-primary",s.strRemoveButtonCls="",s.strSubmitButtonCls="md-accent",i.isDefined(f.lfOption)&&i.isObject(s.lfOption)&&(s.lfOption.hasOwnProperty("browseIconCls")&&(s.strBrowseIconCls=s.lfOption.browseIconCls),s.lfOption.hasOwnProperty("removeIconCls")&&(s.strRemoveIconCls=s.lfOption.removeIconCls),s.lfOption.hasOwnProperty("captionIconCls")&&(s.strCaptionIconCls=s.lfOption.captionIconCls),s.lfOption.hasOwnProperty("unknowIconCls")&&(s.strUnknowIconCls=s.lfOption.unknowIconCls),s.lfOption.hasOwnProperty("strSubmitIconCls")&&(s.strSubmitIconCls=s.lfOption.strSubmitIconCls),s.lfOption.hasOwnProperty("strBrowseButtonCls")&&(s.strBrowseButtonCls=s.lfOption.strBrowseButtonCls),s.lfOption.hasOwnProperty("strRemoveButtonCls")&&(s.strRemoveButtonCls=s.lfOption.strRemoveButtonCls),s.lfOption.hasOwnProperty("strSubmitButtonCls")&&(s.strSubmitButtonCls=s.lfOption.strSubmitButtonCls)),s.accept=s.accept||"",s.lfFiles=[],s[f.ngModel]=s.lfFiles,s.$watch("lfFiles.length",function(e,i){u.$validate()}),s.lfApi=new function(){var e=this;e.removeAll=function(){s.removeAllFiles()},e.removeByName=function(e){s.removeFileByName(e)}},s.isFilesNull=!0,s.strCaption="",s.strCaptionPlaceholder="Select file",s.strCaptionDragAndDrop="Drag & drop files here...",s.strCaptionBrowse="Browse",s.strCaptionRemove="Remove",s.strCaptionSubmit="Submit",s.strAriaLabel="",i.isDefined(f.ariaLabel)&&(s.strAriaLabel=f.ariaLabel),i.isDefined(f.lfPlaceholder)&&s.$watch("lfPlaceholder",function(e){s.strCaptionPlaceholder=e}),i.isDefined(f.lfCaption)&&(p=!0,s.$watch("lfCaption",function(e){s.strCaption=e})),s.lfDragAndDropLabel&&(s.strCaptionDragAndDrop=s.lfDragAndDropLabel),s.lfBrowseLabel&&(s.strCaptionBrowse=s.lfBrowseLabel),s.lfRemoveLabel&&(s.strCaptionRemove=s.lfRemoveLabel),s.lfSubmitLabel&&(s.strCaptionSubmit=s.lfSubmitLabel),i.isDefined(f.lfSubmit)){var b=i.element(a[0].querySelector("#submitButton"));b.on("click",v)}d.bind("dragover",function(e){e.stopPropagation(),e.preventDefault(),!s.isDisabled&&s.isDrag&&d.addClass("lf-ng-md-file-input-drag-hover")}),d.bind("dragleave",function(e){e.stopPropagation(),e.preventDefault(),!s.isDisabled&&s.isDrag&&d.removeClass("lf-ng-md-file-input-drag-hover")}),d.bind("drop",function(e){if(e.stopPropagation(),e.preventDefault(),!s.isDisabled&&s.isDrag){d.removeClass("lf-ng-md-file-input-drag-hover"),i.isObject(e.originalEvent)&&(e=e.originalEvent);var t=e.target.files||e.dataTransfer.files,n=0;if(!(t.length<=0)){var l=s.lfFiles.map(function(e){return e.lfFileName}),r=new RegExp(s.accept,"i");if(s.floatProgress=0,s.isMutiple){g=t.length;for(var n=0;n<t.length;n++){var o=t[n];o.type.match(r)&&(l.indexOf(o.name)!=-1&&s.removeFileByName(o.name),setTimeout(C(o),100*n))}}else{g=1;for(var n=0;n<t.length;n++){var o=t[n];if(o.type.match(r)){s.removeAllFiles(),setTimeout(C(o),100);break}}}}}}),s.openDialog=function(e,i){e&&o(function(){e.preventDefault(),e.stopPropagation();var i=e.target.children[2];i!==t&&i.click()},0)},s.removeAllFiles=function(e){s.isDisabled||(s.lfFiles.length=0,m.empty(),h())},s.removeFileByName=function(e,i){s.isDisabled||(s.lfFiles.every(function(i,t){return i.lfFileName!=e||(i.element.remove(),s.lfFiles.splice(t,1),!1)}),h())},s.onFileChanged=function(e){var i=e.files||e.target.files,t=s.lfFiles.map(function(e){return e.lfFileName});if(!(i.length<=0)){if(s.floatProgress=0,s.isMutiple){g=i.length;for(var n=0;n<i.length;n++){var l=i[n];t.indexOf(l.name)!=-1&&s.removeFileByName(l.name),setTimeout(C(l),100*n)}}else{g=1;for(var n=0;n<i.length;n++){var l=i[n];s.removeAllFiles(),setTimeout(C(l),100);break}}c.val("")}},c.bind("change",s.onFileChanged),s.onFileClick=function(e){i.isFunction(s.lfOnFileClick)&&s.lfFiles.every(function(i,t){return i.key!=e||(s.lfOnFileClick(i,t),!1)})};var C=function(t){s.intLoading++,B(t).then(function(l){var o=t,a=t.name,f=t.type,u=w(t),c=e.URL.createObjectURL(t),d={key:n(),lfFile:o,lfFileName:a,lfDataUrl:c};s.lfFiles.push(d);var p=i.element('<div class="lf-ng-md-file-input-frame" ng-click="onFileClick(\''+d.key+"')\"></div>"),g=i.element('<div aria-label="remove '+t.name+'" class="lf-ng-md-file-input-x" ng-click="removeFileByName(\''+t.name+"',$event)\">&times;<div>"),v="";v="image"==u?'<img src="'+c+'" >':"video"==u?["<video controls>",'<source src="'+c+'" type="'+f+'">',"</video>"].join(""):"audio"==u?["<audio controls>",'<source src="'+c+'" type="'+f+'">',"</audio>"].join(""):['<object data="'+c+'" type="'+f+'"><param name="movie" value="'+o.name+'" />','<div class="lf-ng-md-file-input-preview-default">','<md-icon class="lf-ng-md-file-input-preview-icon" ng-class="strUnknowIconCls"></md-icon>',"</div>","</object>"].join("");var b=i.element(v),C=i.element('<div class="lf-ng-md-file-input-frame-footer"><div class="lf-ng-md-file-input-frame-caption">'+o.name+"</div></div>");p.append(g),p.append(b),p.append(C),r(p)(s),m.append(p),d.element=p,h()},function(e){},function(e){})},h=function(){1==s.lfFiles.length?(p||(s.strCaption=""+s.lfFiles[0].lfFileName),s.isFilesNull=!1):s.lfFiles.length>1?(p||(s.strCaption=""+s.lfFiles.length+" files selected"),s.isFilesNull=!1):(p||(s.strCaption=""),s.isFilesNull=!0)},w=function(e){var i=e.type,t=e.name;return F(i,t)?"image":y(i,t)?"video":D(i,t)?"audio":"object"},F=function(e,i){return!(!e.match("image.*")&&!i.match(/\.(gif|png|jpe?g)$/i))},y=function(e,i){return!(!e.match("video.*")&&!i.match(/\.(og?|mp4|webm|3gp)$/i))},D=function(e,i){return!(!e.match("audio.*")&&!i.match(/\.(ogg|mp3|wav)$/i))},B=function(e,i){var t=l.defer(),n=new FileReader;return n.onloadstart=function(){t.notify(0)},n.onload=function(e){},n.onloadend=function(e){t.resolve({index:i,result:n.result}),s.intLoading--,s.floatProgress=(g-s.intLoading)/g*100},n.onerror=function(e){t.reject(n.result),s.intLoading--,s.floatProgress=(g-s.intLoading)/g*100},n.onprogress=function(e){t.notify(e.loaded/e.total)},n.readAsArrayBuffer(e),t.promise}}}}])}(window,window.angular);